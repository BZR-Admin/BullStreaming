<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bull Streaming - Tu Centro de Entretenimiento</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Íconos Font Awesome (Requerido para la sección "Por qué elegirnos") -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 1. Carga de bibliotecas de Firebase (Necesario para el contador) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs, runTransaction, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Establecer nivel de log para depuración de Firestore
        setLogLevel('Debug');

        // Variables globales de Canvas (se proporcionan en tiempo de ejecución)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;

        // Función de inicialización y autenticación
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Autenticación con token personalizada exitosa.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Autenticación anónima exitosa.");
                }
                
                // Una vez autenticado, inicializa el contador
                if(auth.currentUser) {
                    await updateDailyPageViewCount();
                }

            } catch (error) {
                console.error("Error al inicializar o autenticar Firebase:", error);
            }
        }

        /**
         * Lógica para obtener la fecha actual en formato YYYY-MM-DD
         * @returns {string} Fecha actual.
         */
        function getCurrentDateString() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        /**
         * Actualiza el contador de visitas diarias en Firestore.
         */
        async function updateDailyPageViewCount() {
            const today = getCurrentDateString();
            // Ruta del documento para el contador de visitas diarias públicas
            const counterRef = doc(db, 'artifacts', appId, 'public', 'data', 'counters', 'daily_visits');
            const counterElement = document.getElementById('contador-visitas');
            
            try {
                await runTransaction(db, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);

                    let currentCount = 0;
                    let lastDate = null;
                    
                    // Si el documento existe, obtenemos los datos
                    if (counterDoc.exists()) {
                        const data = counterDoc.data();
                        currentCount = data.count || 0;
                        lastDate = data.date;
                    }

                    // 1. Lógica de Reinicio Diario
                    if (lastDate === today) {
                        // Mismo día: solo incrementamos el contador
                        currentCount += 1;
                        transaction.update(counterRef, { count: currentCount });
                    } else {
                        // Nuevo día: reiniciamos el contador a 1 y actualizamos la fecha
                        currentCount = 1;
                        transaction.set(counterRef, { count: currentCount, date: today }, { merge: true });
                    }

                    // 2. Actualizar el DOM
                    if (counterElement) {
                        counterElement.textContent = currentCount.toLocaleString('es-ES');
                    }
                });
                console.log("Contador de visitas actualizado con éxito.");
            } catch (error) {
                console.error("Error en la transacción del contador de visitas:", error);
                if (counterElement) {
                    counterElement.textContent = "N/A";
                }
            }
        }

        // Iniciar todo al cargar la página
        window.onload = initializeFirebase;
    </script>
</head>
<body>

    <header class="header">
        <div class="container">
            <div class="logo-container">
                <img src="logo-bull-streaming.png" alt="Bull Streaming Logo" class="logo">
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link current">Inicio</a>
                <a href="precios.html" class="nav-link">Precios</a>
                <a href="revendedores.html" class="nav-link">Revendedores</a>
                <a href="contacto.html" class="nav-link">Contacto</a>
                </nav>
        </div>
    </header>

    <main class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title neon-yellow">
                    El mejor centro de entretenimiento. <br>
                    Todas las plataformas de streaming, 100% confiables y al mejor precio.
                </h1>
                
                <div class="hero-cta-group">
                    <a href="precios.html" class="btn btn-primary btn-neon-red">
                        Ver Planes y Precios ⚡
                    </a>
                    <a href="revendedores.html" class="btn btn-secondary btn-neon-cyan">
                        Conviértete en Revendedor 📈
                    </a>
                </div>
                
                <!-- NUEVO ELEMENTO: Recuadro del Contador de Visitas -->
                <div class="visits-counter-box" style="margin-top: 30px;">
                    <p class="counter-label">Visitas de Hoy:</p>
                    <!-- El ID "contador-visitas" es donde el script inyectará el número -->
                    <span id="contador-visitas" class="counter-value neon-yellow">...</span>
                </div>
                <!-- FIN NUEVO ELEMENTO -->

            </div>
        </div>
    </main>

    <section class="propuesta-valor">
        <div class="container">
            <h2 class="section-title neon-cyan">¿Por Qué Elegir Bull Streaming?</h2>
            <div class="valor-grid">
                
                <div class="valor-item">
                    <i class="icon fas fa-check-circle neon-red"></i> <!-- Usando Font Awesome -->
                    <h3>Activación Inmediata</h3>
                    <p>Recibe tu cuenta y empieza a ver contenido en cuestión de minutos.</p>
                </div>
                
                <div class="valor-item">
                    <i class="icon fas fa-shield-alt neon-red"></i> <!-- Usando Font Awesome -->
                    <h3>Soporte Garantizado</h3>
                    <p>Te ayudamos con cualquier duda o problema durante toda tu suscripción. Soporte técnico 24/7.</p>
                </div>

                <div class="valor-item">
                    <i class="icon fas fa-credit-card neon-red"></i> <!-- Usando Font Awesome -->
                    <h3>Pagos Fáciles y Seguros</h3>
                    <p>Aceptamos múltiples métodos de pago, simplificando tu experiencia de compra.</p>
                </div>

            </div>
        </div>
    </section>

    <section class="plataformas-populares">
        <div class="container">
            <h2 class="section-title neon-yellow">Plataformas Populares</h2>
            <div class="logos-grid">
                <img src="netflix.png" alt="N3tflix">
                <img src="disney.png" alt="Dlsney+">
                <img src="hbo.png" alt="HB0 Max">
                <img src="spotify.png" alt="Spot1fy">
                <img src="prime.png" alt="Amazon Pr1me V1deo">
                <img src="flujo.png" alt="Flujo TV">
                </div>
        </div>
    </section>

    <section class="ofertas-destacadas">
        <div class="container">
            <h2 class="section-title neon-red">¡Oferta Destacada del Mes!</h2>
            
            <div class="oferta-card">
                <p class="etiqueta-ahorro">💥 PLATAFORMA MÁS VENDIDA 💥</p>
                <h3>PRIME VIDEO</h3>
                <p class="precio-antes">Precio regular: $2.50</p>
                <p class="precio-oferta neon-yellow">$2.00 / mes</p>
                <a href="precios.html" class="btn btn-principal btn-neon-cyan">
                    ¡Lo Quiero! Ver Detalles
                </a>
            </div>

            <p class="small-text">Válido hasta fin de mes.</p>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Bull Streaming. Todos los derechos reservados.</p>
            <div class="footer-links">
                <a href="contacto.html" class="footer-link">Contacto</a>
                <a href="#" class="footer-link">Términos y Condiciones</a>
                <a href="#" class="footer-link">Política de Privacidad</a>
            </div>
        </div>
    </footer>

</body>
</html>
